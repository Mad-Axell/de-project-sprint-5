#  Слой CDM

### Состав витрины dm_restaurant_settlement_report :
- **id**                        - Идентификатор записи.
- **restaurant_id**             - Сквозной идентификатор ресторана.
- **restaurant_name**           - Наименование ресторана.
- **settlement_year**           - Год отчета.
- **settlement_month**          - Месяц отчета, где 1 - январь и 12 - декабрь.
- **orders_count**              - Количество заказов за период (месяц).
- **orders_total_sum**          - Общая сумма заказов. Т.е. сумма платежей клиентов.
- **orders_bonus_payment_sum**  - Сумма оплат бонусами за период.
- **orders_bonus_granted_sum**  - Сумма накопленных бонусов за период.
- **order_processing_fee**      - Сумма, удержанная компанией за обработку заказов. Высчитывается как orders_total_sum * 0.25.
- **restaurant_reward_sum**     - Сумма, которую необходимо перечислить ресторану. total_sum - orders_bonus_payment_sum - order_processing_fee.



### Состав витрины dm_courier_settlement_report :
- **id** 						— Идентификатор записи.
- **courier_id** 				— Сквозной идентификатор курьера.
- **courier_name** 				— Ф. И. О. курьера.
- **settlement_year** 			— Год отчёта.
- **settlement_month** 			— Месяц отчёта, где 1 — январь и 12 — декабрь.
- **orders_count** 				— Количество заказов за период (месяц).
- **orders_total_sum** 			— Общая стоимость заказов.
- **rate_avg** 					— Средний рейтинг курьера по оценкам пользователей.
- **order_processing_fee** 		— Сумма, удержанная компанией за обработку заказов, которая высчитывается как orders_total_sum * 0.25.
- **courier_order_sum** 		— Сумма, которую необходимо перечислить курьеру за доставленные им/ей заказы. За каждый доставленный заказ курьер должен получить некоторую сумму в зависимости от рейтинга (см. ниже).
- **courier_tips_sum** 			— Сумма, которую пользователи оставили курьеру в качестве чаевых.
- **courier_reward_sum** 		— Сумма, которую необходимо перечислить курьеру. Вычисляется как courier_order_sum + courier_tips_sum * 0.95 (5% — комиссия за обработку платежа).


# Слой DDS

### Состав таблицы dm_users :
- **id** 				— Идентификатор записи.
- **user_id** 			— Сквозной идентификатор клиента.
- **user_name** 		— Ф. И. О. клиента.
- **user_login** 		— Логин клиента.

### Состав таблицы dm_restaurants :
- **id** 				— Идентификатор записи.
- **restaurant_id** 	— Сквозной идентификатор ресторана.
- **restaurant_name** 	— Наименование ресторана.
- **active_from** 		— Дата с которой запись считается валидной
- **active_to** 		— Дата с которой запись считается не валидной

### Состав таблицы dm_timestamps :
- **id** 				— Идентификатор записи. 
- **ts** 				— Метка времени совершённого события
- **year** 				— Год совершённого события
- **mont** 				— Месяц совершённого события
- **day** 				— День совершённого события
- **time** 				— Время совершённого события
- **date** 				— Дата совершённого события



### Состав таблицы dm_products :
- **id** 				— Идентификатор записи.
- **restaurant_id** 	— Идентификатор записи о ресторане из таблицы dm_restaurants.
- **product_id** 		— Сквозной идентификатор продукта.
- **product_name** 		— Наименование продукта.
- **product_price** 	— Стоимость продукта.
- **active_from** 		— Дата с которой запись считается валидной
- **active_to** 		— Дата с которой запись считается не валидной

### Состав таблицы dm_orders :
- **id** 				— Идентификатор записи.
- **order_key** 		— Сквозной идентификатор продукта.
- **order_status** 		— Статус заказа.
- **user_id** 			— Идентификатор записи о клиенте из таблицы dm_users.
- **restaurant_id** 	— Идентификатор записи о ресторане из таблицы dm_restaurants.
- **timestamp_id** 		— Идентификатор записи о метке времени из таблицы dm_timestamps.



### Состав таблицы fct_product_sales :
- **id** 				— Идентификатор записи.
- **product_id**		— Идентификатор записи о продукте из таблицы dm_products.
- **order_id**			— Идентификатор записи о заказе из таблицы dm_orders.
- **count**				— Количество приобретённого товара.
- **price**				— Стоимость одной единицы товара.
- **total_sum**			— Сумма удержанная за указанное количество товаров.
- **bonus_payment**		— Часть заказа оплаченная клиентом бонусами.
- **bonus_grant**		— Количество бонусов начисленных за заказ.

### Состав таблицы dm_couriers :
- **id**		    	—
- **courier_id**		—
- **name**			    —

### Состав таблицы fct_deliveries :
- **id**			    —
- **delivery_id**		—
- **courier_id**		—
- **order_id**			—
- **order_ts**			—
- **delivery_ts**		—
- **address**			—
- **rate**		    	—
- **tip_sum**			—
- **total_sum**			—



# Слой STG

## Источник PostgreSQL (система бонусов)

### Состав таблицы bonussystem_users :
- **id** 				    — Идентификатор записи.
- **order_user_id**		    — Сквозной идентификатор клиента.

### Состав таблицы bonussystem_ranks :
- **id**					— 
- **name**					— 
- **bonus_percent**			— 
- **min_payment_threshold**	— 

### Состав таблицы bonussystem_events :
- **id**					— 
- **event_ts**				— 
- **event_type**			— 
- **event_value**			— 

## Источник MongoDB (система заказов)

### Состав таблицы ordersystem_users :
- **id**					— 
- **object_id**				— 
- **object_value**			— 
- **update_ts**				— 

### Состав таблицы ordersystem_restaurants :
- **id**					— 
- **object_id**				— 
- **object_value**			— 
- **update_ts**				— 

### Состав таблицы ordersystem_orders :
- **id**					— 
- **object_id**				— 
- **object_value**			— 
- **update_ts**				— 

## Источник API (система доствки)

### Состав таблицы deliverysystem_couriers :
- **id**			    	— 
- **object_id**  			— 
- **load_ts**				— 
- **json_value**			— 

### Состав таблицы deliverysystem_deliveries :
- **id**					— 
- **object_id**				— 
- **load_ts**				— 
- **json_value**			— 